<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Undangan Seminar Pendidikan Anak</title>
    <script src="https://cdn.tailwindcss.com"></script>
        <style>
        body {
            box-sizing: border-box;
            font-size: 12px;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes glow-pulse {
            0%, 100% { 
                text-shadow: 0 0 20px rgba(34, 197, 94, 0.3), 0 0 40px rgba(59, 130, 246, 0.2);
                transform: scale(1);
            }
            50% { 
                text-shadow: 0 0 30px rgba(34, 197, 94, 0.6), 0 0 60px rgba(59, 130, 246, 0.4);
                transform: scale(1.02);
            }
        }
        
        .bounce-animation {
            animation: bounce 2s infinite;
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        .glow-title {
            animation: glow-pulse 3s ease-in-out infinite;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
        }
        
        .card-shadow {
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center p-4">
    <main class="w-full max-w-lg mx-auto">
        <div id="invitationPage" class="bg-white rounded-xl shadow-lg">
            <div class="p-8 text-center">
                <h1 class="text-3xl font-bold mb-4">Undangan Seminar Parenting</h1>
                <img src="https://i.imgur.com/QVVFX7w.jpeg" alt="Poster Seminar" class="w-full rounded-lg mb-6">
                <p class="mb-6">Konfirmasi kehadiran Bapak/Ibu di sini üëá</p>
                <button onclick="showPage('registrationPage')" class="w-full bg-blue-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-600 transition-all">
                    ‚úÖ Konfirmasi Kehadiran
                </button>
            </div>
        </div>

        <div id="registrationPage" class="w-full max-w-lg mx-auto hidden">
            <div class="bg-white rounded-xl shadow-lg">
                <div class="bg-blue-500 p-6 text-center rounded-t-xl">
                    <h1 class="text-2xl font-bold text-white">Form Registrasi</h1>
                </div>
                <div class="p-6">
                    <form id="registrationForm" onsubmit="submitForm(event)">
                        <div class="mb-4">
                            <label for="namaOrtu" class="block font-semibold text-gray-700 mb-2">Nama Orang Tua</label>
                            <input type="text" id="namaOrtu" name="namaOrtu" required class="w-full px-4 py-2 border rounded-lg">
                        </div>
                        <div class="mb-4">
                            <label for="namaSiswa" class="block font-semibold text-gray-700 mb-2">Nama Siswa</label>
                            <input type="text" id="namaSiswa" name="namaSiswa" required class="w-full px-4 py-2 border rounded-lg">
                        </div>
                        <div class="mb-4">
                            <label for="jenjang" class="block font-semibold text-gray-700 mb-2">Jenjang/Kelas</label>
                            <input type="text" id="jenjang" name="jenjang" required class="w-full px-4 py-2 border rounded-lg">
                        </div>
                        <div class="mb-4">
                            <label class="block font-semibold text-gray-700 mb-2">Pilih Jadwal</label>
                            <label class="flex items-center p-2 border rounded-lg"><input type="radio" name="jadwal" value="Sabtu, 1 November 2025" required class="mr-2"> Pati-Juwana</label>
                            <label class="flex items-center p-2 border rounded-lg mt-2"><input type="radio" name="jadwal" value="Ahad, 9 November 2025" required class="mr-2"> Kudus-Jepara</label>
                        </div>
                        <div class="mb-4">
                            <label class="block font-semibold text-gray-700 mb-2">Yang Hadir</label>
                            <label class="flex items-center p-2 border rounded-lg"><input type="radio" name="yangHadir" value="Ayah/Wakil Ayah" required class="mr-2"> Ayah/Wakil Ayah</label>
                            <label class="flex items-center p-2 border rounded-lg mt-2"><input type="radio" name="yangHadir" value="Bunda/Wakil Bunda" required class="mr-2"> Bunda/Wakil Bunda</label>
                        </div>
                        <div class="mb-6">
                            <label class="block font-semibold text-gray-700 mb-2">Status Kehadiran</label>
                            <label class="flex items-center p-2 border rounded-lg"><input type="radio" name="kehadiran" value="Hadir" required class="mr-2"> Hadir</label>
                            <label class="flex items-center p-2 border rounded-lg mt-2"><input type="radio" name="kehadiran" value="Tidak Hadir" required class="mr-2"> Tidak Hadir</label>
                        </div>
                        <button type="submit" id="submitBtn" class="w-full bg-blue-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-600">Kirim Registrasi</button>
                    </form>
                    <div id="successMessage" class="hidden mt-4 p-4 bg-green-100 text-green-800 rounded-lg">Registrasi Berhasil! Terima kasih. <button onclick="showPage('dashboardPage')" class="underline">Lihat Papan Konfirmasi</button></div>
                    <div id="errorMessage" class="hidden mt-4 p-4 bg-red-100 text-red-800 rounded-lg"><span id="errorText"></span></div>
                </div>
            </div>
        </div>

        <div id="dashboardPage" class="w-full max-w-lg mx-auto hidden">
            <div class="bg-white rounded-xl shadow-lg">
                <div class="bg-purple-500 p-6 text-center rounded-t-xl relative">
                     <button onclick="showPage('invitationPage')" class="absolute top-4 left-4 text-white">‚Üê Kembali</button>
                    <h1 class="text-2xl font-bold text-white">Papan Konfirmasi</h1>
                </div>
                <div class="p-6">
                    <div id="dashboardLoading" class="text-center py-8">Memuat data...</div>
                    <div id="dashboardContent" class="hidden">
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-green-100 text-center p-4 rounded-lg"><div class="text-3xl font-bold" id="hadirCount">0</div><div>Hadir</div></div>
                            <div class="bg-red-100 text-center p-4 rounded-lg"><div class="text-3xl font-bold" id="tidakHadirCount">0</div><div>Tidak Hadir</div></div>
                        </div>
                        <button onclick="loadDashboardData()" class="w-full bg-purple-500 text-white font-bold py-3 px-6 rounded-lg">Refresh Data</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // === GANTI URL INI DENGAN URL DEPLOYMENT APPS SCRIPT LU ===
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxtyj8ISzh_P2lFgqTCxlODHtyF2tQmDu9rsZXm_H_k9BC0V7GeqMCoojfzs5xvmWvxPw/exec';

        // Fungsi simpel untuk pindah-pindah halaman
        function showPage(pageId) {
            document.getElementById('invitationPage').classList.add('hidden');
            document.getElementById('registrationPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById(pageId).classList.remove('hidden');

            if (pageId === 'dashboardPage') {
                loadDashboardData();
            }
        }

        // Fungsi untuk menampilkan pesan error
        function showErrorMessage(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').classList.remove('hidden');
        }

        // --- FUNGSI SUBMIT FORM (INI YANG DIPERBAIKI) ---
        async function submitForm(event) {
            event.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            
            submitBtn.textContent = '‚è≥ Mengirim...';
            submitBtn.disabled = true;
            document.getElementById('errorMessage').classList.add('hidden');

            const formData = new FormData(event.target);
            const data = {
                timestamp: new Date().toLocaleString('id-ID'),
                namaOrtu: formData.get('namaOrtu'),
                namaSiswa: formData.get('namaSiswa'),
                jenjang: formData.get('jenjang'),
                jadwal: formData.get('jadwal'),
                yangHadir: formData.get('yangHadir'),
                kehadiran: formData.get('kehadiran')
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Penting untuk beberapa kasus Apps Script
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                // Karena 'no-cors', kita tidak bisa baca response.json()
                // Jadi kita anggap berhasil jika tidak ada error jaringan
                console.log('Data sent successfully.');
                document.getElementById('registrationForm').classList.add('hidden');
                document.getElementById('successMessage').classList.remove('hidden');

            } catch (error) {
                console.error('Error saat mengirim form:', error);
                showErrorMessage('Gagal mengirim data. Cek koneksi atau coba lagi.');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }
        
        // --- FUNGSI DASHBOARD (INI JUGA DIPERBAIKI) ---
        async function loadDashboardData() {
            const loading = document.getElementById('dashboardLoading');
            const content = document.getElementById('dashboardContent');
            
            loading.classList.remove('hidden');
            content.classList.add('hidden');

            try {
                // Fetch data LANGSUNG dari Google Apps Script
                const response = await fetch(SCRIPT_URL);
                if (!response.ok) {
                    throw new Error('Gagal mengambil data dari server.');
                }
                const result = await response.json();
                
                // Update tampilan dengan data asli dari sheet
                document.getElementById('hadirCount').textContent = result.counts.hadir;
                document.getElementById('tidakHadirCount').textContent = result.counts.tidak;

            } catch (error) {
                console.error('Error saat memuat dashboard:', error);
                // Kalau gagal, tampilkan angka 0
                document.getElementById('hadirCount').textContent = 'X';
                document.getElementById('tidakHadirCount').textContent = 'X';
            } finally {
                loading.classList.add('hidden');
                content.classList.remove('hidden');
            }
        }
    </script>
</body>
</html>
